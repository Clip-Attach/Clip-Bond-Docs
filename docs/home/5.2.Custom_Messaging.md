# 5.Data Transfer

## 5.2.Custom Messaging

## Custom Message Send



### 1. Initialization

```C# title="RegisterMsgHandler S100F4"

CustomMessageSend S100F4_FOUPStatus;

void init_CustomMessageSend()
{
    S100F4_FOUPStatus = new CustomMessageSend(1, 100, 4, HandleS100F4);
}
void clos_CustomMessageSend()
{
    S100F4_FOUPStatus.Dispose();
}
```

### 2、Equipment Send Message

```c# title="Send Message S100F3"
// Send S100F3 to get the next FOUP's status from the Host
private void buttonS100F3_Click(object sender, EventArgs e)
{
    //S100F4_FOUPStatus.message
    S100F4_FOUPStatus.Request();
}
```

![](https://easyimage.ghuang.top/i/2024/06/25/115211-1.webp)

### 3. Host Reply Message

```yaml title="S100F4"
<ASC>111</ASC>
```

![](https://easyimage.ghuang.top/i/2024/06/25/115333-1.webp)

### 4、Equipment Received Message

```C# title="Equipment Received"
void HandleS100F4(CMyCimetrix.MyMessageReceivedEventArgs message, VALUELib.CxValueObject replyMessage)
{
    //S100F4 has the following format
    //<A FOUPSTATUS>

    VALUELib.ValueType valType;
    message.MessageBody.GetDataType(0, 0, out valType);
    if (valType == VALUELib.ValueType.A)
    {
        string FOUPStatus;
        message.MessageBody.GetValueAscii(0, 0, out FOUPStatus);
        textBoxFOUPStatus.Text = FOUPStatus;
    }
}
```

![](https://easyimage.ghuang.top/i/2024/06/25/115658-1.webp)


## Custom Message Receive 

### 1. Initialization

```C# title="RegisterMsgHandler S21F1"
CustomMessageReceive S21F1_Receive;

void init_CustomMessageReceive()
{
    # RegisterMsgHandler S21F1
    S21F1_Receive = new CustomMessageReceive(1, 21, 1, HandleS21F1);
}

void clos_CustomMessageReceive()
{
    S21F1_Receive.Dispose();
}
```

### 2. Host Send Message

```yaml title="S21F1"
<LST>
  <ASC>TypeA</ASC>
  <ASC>ID1234</ASC>
  <UI8>256</UI8>
  <ASC>v1.0</ASC>
</LST>
```

![](https://easyimage.ghuang.top/i/2024/06/25/113344-1.webp)

### 3. Equipment Received Message

```C# title="Equipment Received Message"
void HandleS21F1(CMyCimetrix.MyMessageReceivedEventArgs message, VALUELib.CxValueObject replyMessage)
{
    try
    {
        message.MessageBody.GetValueAscii(0, 1, out string ITEMTYPE);
        message.MessageBody.GetValueAscii(0, 2, out string ITEMID);
        message.MessageBody.GetValueInt(0, 3, out string ITEMLENGTH);
        message.MessageBody.GetValueAscii(0, 4, out int ITEMVERSION);

        replyMessage.AppendValueBinary(0, 0); // ITEMACK 0 == OK
        replyMessage.AppendValueAscii(0, ""); // Empty ITEMERROR
    }
    catch (Exception e)
    {
        //_CMyCimetrix.HandleException("Exception calling HandleS21F1", e);
        replyMessage.AppendValueBinary(0, 13); // ITEMACK 13 == Error
        replyMessage.AppendValueAscii(0, "Exception handling S21F3"); // Empty ITEMERROR
    }
}
```


## 其他


```yaml title="1、RegisterMsgHandler："
`S14F2`
`S100F4`
```

```yaml title="2、Equipment SendMessage："
- Software SendMessage

S14F1: 
Equipment ->S14F1
buttonRequestMapDataFromHost_Click
Software SFtoMsgID(14, 1) -》 Host SendMessage：HandleS14F2

S100F3: 
Equipment ->S100F3
buttonS100F3_Click  
Software SFtoMsgID(100, 3) -》 Host SendMessage：HandleS100F4
```

```yaml title="3、Host SendMessage："
S100F4:
<ASC>111</ASC>
```

```yaml title="4、Equipment MessageReceived："
- ICxEMAppCallback.MessageReceived

Software Received `HandleS14F2` 
Software Received `HandleS100F4` 
```

```yaml
RegisterMsgHandler

S100F1
S21F1
S21F3
S21F5
S7F5
`S14F2`
`S100F4`


MessageReceived
ICxEMAppCallback.MessageReceived

Host HandleS100F1    ->Software SendMessage S100F2
Host HandleS21F1    ->Software SendMessage S21F2
Host HandleS21F3    ->Software SendMessage S21F4
Host HandleS21F5    ->Software SendMessage S21F6

Software Received `HandleS14F2` 
Software Received `HandleS100F4` 


Software SendMessage

S14F1:
buttonRequestMapDataFromHost_Click
Software SFtoMsgID(14, 1) -》 Host SendMessage：HandleS14F2

S100F3:
buttonS100F3_Click  
Software SFtoMsgID(100, 3) -》 Host SendMessage：HandleS100F4

```

![](https://easyimage.ghuang.top/i/2024/06/24/144543-1.webp)
