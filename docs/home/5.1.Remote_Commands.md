# 5.Data Transfer

## 5.1.Remote Commands

### C# ä½¿ç”¨

#### 1ã€åˆå§‹åŒ–

```c# title="Demo.cs"

/// <summary>
/// è¿œç¨‹é”å®šæœºå™¨
/// </summary>
RemoteCommand reLockMachine;

/// <summary>
/// è¿œç¨‹å¯åŠ¨æœºå™¨
/// </summary>
RemoteCommand reStartMachine;

/// <summary>
/// åˆå§‹åŒ–
/// </summary>
void init_RemoteCommand()
{
    reLockMachine = new RemoteCommand("LockMachine", "1. Lock machine.", act_LockMachine);
    reStartMachine = new RemoteCommand("StartMachine", "2. Start machine.", act_StartMachine);
}

/// <summary>
/// `reLockMachine` è¿œç¨‹é”å®šæœºå™¨æ—¶ï¼Œè§¦å‘çš„å›è°ƒ
/// </summary>
void act_LockMachine()
{
    MessageBox.Show("1. Lock machine.");
}

/// <summary>
/// `reStartMachine` è¿œç¨‹å¯åŠ¨æœºå™¨æ—¶ï¼Œè§¦å‘çš„å›è°ƒ
/// </summary>
void act_StartMachine()
{
    MessageBox.Show("2. Start machine.");
}

```

#### 2ã€é”€æ¯å›è°ƒå‡½æ•°

```c# title="Demo.cs"
/// <summary>
/// é”€æ¯å›è°ƒå‡½æ•°
/// </summary>
void clos_RemoteCommand()
{
    reLockMachine.Dispose();
    reStartMachine.Dispose();
}
```

#### 3ã€è¿œç¨‹ä½œä¸šæ—¶ï¼Œè‡ªåŠ¨è§¦å‘çš„å›è°ƒ

```c# title="Demo.cs"
/// <summary>
/// `reLockMachine` è¿œç¨‹é”å®šæœºå™¨æ—¶ï¼Œè§¦å‘çš„å›è°ƒ
/// </summary>
void act_LockMachine()
{
    // åŠ å…¥ä¸šåŠ¡é€»è¾‘
}

/// <summary>
/// `reStartMachine` è¿œç¨‹å¯åŠ¨æœºå™¨æ—¶ï¼Œè§¦å‘çš„å›è°ƒ
/// </summary>
void act_StartMachine()
{
    // åŠ å…¥ä¸šåŠ¡é€»è¾‘
}

```

### Verification Test

- S2F41
- token:clip-attach

#### 1ã€GEM Host

- Command: `LockMachine`
- Command: `StartMachine`
- Command: `LightSwitch`
---
- Name: `token`
- Value: `A clip-attach`

```yaml
<LST>
  <ASC>LockMachine</ASC>
  <LST>
    <LST>
      <ASC>token</ASC>
      <ASC>clip-attach</ASC>
    </LST>
  </LST>
</LST>
```

![](https://easyimage.ghuang.top/i/2024/06/18/194832-1.webp)

![](https://easyimage.ghuang.top/i/2024/06/18/195021-1.webp)


#### 2ã€Software Application

![](https://easyimage.ghuang.top/i/2024/06/18/195232-1.webp)


```c# title="Demo.cs"
void act_LockMachine()
{
    // åŠ å…¥ä¸šåŠ¡é€»è¾‘
    MessageBox.Show("1. Lock machine.");
}
```


## StateMachine

```c# title="MyProcessState"
public enum MyProcessState
{
    SETUP = 0,
    IDLE = 1,
    EXECUTING = 2
};
public MyProcessState _MyProcessState;
```

### ButtonSTART_Click

```ini
[COMMON VARIABLES]
6=OperatorCommand,The name of a command issued by the machine operator.,,DV,A,,0,0,,,A,OperatorCommand

[COMMON EVENTS]
6=OperatorCommandIssued,Machine operator issued a control command.,OperatorCommandIssued,L {A OperatorCommand}
201=ProcessStateToEXECUTING,A sample user defined collection event for the Processing State Machine,,
```

ğŸ‘‰ ButtonSTART_Click

```C# title="(START) 1ã€H â† E"
var dataNames = "OperatorCommand";
var dataValues = "START";
var eventName = "OperatorCommandIssued"

_CMyCimetrix.SendCollectionEventWithData(0, dataNames, dataValues, eventName);

_EventSTART.Set();
```

```c# title="2ã€H â† E"
var state = MyProcessState.EXECUTING
var stateName = "EXECUTING"
var eventName = "ProcessStateToEXECUTING";

_CxClientClerk.ProcessingStateChange((int)state, ref string stateName, -1, ref string eventName);
```

```C# title="3ã€H â†’ E"
ICxEMAppCallback.StateChange(int connectionID, StateMachine machine, int state)

ğŸ‘‡

var state = MyProcessState.EXECUTING

private void DisplayGEMProcessState(long state)
{
	MyProcessState _MyProcessState;
	_MyProcessState = (MyProcessState)state;
	textBoxProcessingState.Text = _MyProcessState.ToString();
}
```

### ButtonSTOP_Click

```ini
[COMMON VARIABLES]
6=OperatorCommand,The name of a command issued by the machine operator.,,DV,A,,0,0,,,A,OperatorCommand

[COMMON EVENTS]
6=OperatorCommandIssued,Machine operator issued a control command.,OperatorCommandIssued,L {A OperatorCommand}
202=ProcessStateToIDLE,A sample user defined collection event for the Processing State Machine,,
```

ğŸ‘‰ ButtonSTOP_Click

```C# title="(START) 1ã€H â† E"
var dataNames = "OperatorCommand";
var dataValues = "STOP";
var eventName = "OperatorCommandIssued"

_CMyCimetrix.SendCollectionEventWithData(0, dataNames, dataValues, eventName);

_EventSTOP.Set();
```

```c# title="2ã€H â† E"
var state = MyProcessState.IDLE
var stateName = "IDLE"
var eventName = "ProcessStateToIDLE";

_CxClientClerk.ProcessingStateChange((int)state, ref string stateName, -1, ref string eventName);
```

```C# title="3ã€H â†’ E"
ICxEMAppCallback.StateChange(int connectionID, StateMachine machine, int state)

ğŸ‘‡

var state = MyProcessState.IDLE

private void DisplayGEMProcessState(long state)
{
	MyProcessState _MyProcessState;
	_MyProcessState = (MyProcessState)state;
	textBoxProcessingState.Text = _MyProcessState.ToString();
}
```


## Remote_Commands

```yaml title="ButtonSTART_Click"
OperatorCommandIssued
OperatorCommand
START
```
```yaml title="ButtonSTOP_Click"
OperatorCommandIssued
OperatorCommand
STOP
```

### Register Remote Commands

```yaml title="Register"
RegisterCommandHandler("START")
RegisterCommandHandler("STOP")
RegisterCommandHandler("PPSELECT")
```

```yaml title="Unregister"
UnregisterCommandHandler("START")
UnregisterCommandHandler("STOP")
UnregisterCommandHandler("PPSELECT")
```

```C# title="ç›‘æ§å‘½ä»¤"
public event RemoteCommandHandler OnRemoteCommand;
```

